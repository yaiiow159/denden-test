version: '3.8'

services:
  postgres:
    ports: [] 
    volumes:
      - /var/lib/member-auth/postgres:/var/lib/postgresql/data

  redis:
    command: redis-server --requirepass ${REDIS_PASSWORD:?REDIS_PASSWORD required} --maxmemory 512mb --maxmemory-policy allkeys-lru
    ports: [] 
    volumes:
      - /var/lib/member-auth/redis:/data

  app:
    image: ghcr.io/${GITHUB_REPOSITORY:-yaiiow159/member-auth-system}:latest
    build:
      context: .
      dockerfile: Dockerfile
    environment:
      SPRING_PROFILES_ACTIVE: prod
      JAVA_OPTS: -Xms1024m -Xmx2048m -XX:+UseG1GC -XX:MaxMetaspaceSize=512m
    ports:
      - "8080:8080"
    volumes:
      - /var/lib/member-auth/logs:/app/logs
