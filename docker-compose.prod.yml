# Production overrides
# Usage: docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d

version: '3.8'

services:
  postgres:
    ports: []  # 不對外暴露
    volumes:
      - /var/lib/member-auth/postgres:/var/lib/postgresql/data

  redis:
    command: redis-server --requirepass ${REDIS_PASSWORD:?REDIS_PASSWORD required} --maxmemory 512mb --maxmemory-policy allkeys-lru
    ports: []  # 不對外暴露
    volumes:
      - /var/lib/member-auth/redis:/data

  app:
    image: ghcr.io/${GITHUB_REPOSITORY:-your-username/member-auth-system}:latest
    environment:
      SPRING_PROFILES_ACTIVE: prod
      JAVA_OPTS: -Xms1024m -Xmx2048m -XX:+UseG1GC
    ports:
      - "8080:8080"
    volumes:
      - /var/log/member-auth:/app/logs
